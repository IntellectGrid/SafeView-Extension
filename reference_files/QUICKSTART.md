# Quick Start Commands - ONNX Integration

## 1. Convert PyTorch Model to ONNX

### Prerequisites
```powershell
# Create virtual environment
python -m venv venv

# Activate (PowerShell)
.\venv\Scripts\Activate.ps1

# Install dependencies
pip install torch torchvision
```

### Run Conversion
```powershell
# From repo root
python reference_files\convert_to_onnx.py
```

**Output**: `src\assets\models\efficientnetb0\efficientnet_b0.onnx`

---

## 2. Test ONNX Model (Optional)

### Start Local Server
```powershell
# From repo root
python -m http.server 8000
```

### Open Test Page
Open browser: `http://localhost:8000/reference_files/onnx_test.html`

- Select an image
- Click "Run Inference"
- Verify predictions appear (Drawing, Hentai, Neutral, Porn, Sexy)

---

## 3. Load Extension in Chrome

1. Open Chrome
2. Navigate to `chrome://extensions/`
3. Enable "Developer mode" (top right)
4. Click "Load unpacked"
5. Select the extension root directory
6. Verify extension loads without errors

---

## 4. Test Runtime Switching

### Test TFJS (Default)
1. Click extension icon
2. Go to **Advanced Options**
3. Ensure "Detection Model" is set to **TFJS (default)**
4. Visit a page with images (e.g., Instagram)
5. Verify detection works

### Test ONNX
1. Click extension icon
2. Go to **Advanced Options**
3. Change "Detection Model" to **ONNX - EfficientNet B0**
4. Visit a page with images
5. Open browser console (F12)
6. Verify log: "Loading ONNX model..." then "ONNX model loaded successfully"
7. Verify detection works

### Switch Back
1. Change model back to TFJS
2. Verify seamless transition
3. Check that setting persists after closing/reopening popup

---

## 5. Debugging

### View Console Logs
- **Offscreen (detection)**: `chrome://extensions/` → Extension details → "Inspect views: offscreen document"
- **Background**: `chrome://extensions/` → Extension details → "Inspect views: service worker"
- **Content script**: Open page → F12 → Console

### Common Issues

**"ort is not defined"**
- Check `src/offscreen.html` includes ONNX Runtime CDN script
- Reload extension

**"Failed to load ONNX model"**
- Ensure `.onnx` file exists at correct path
- Check console for detailed error
- Verify model was converted successfully

**Wrong predictions**
- Verify preprocessing in `onnx_detector.js` matches training
- Check console logs for inference output

**Extension crashes**
- Check all console views for errors
- Try disabling/re-enabling extension
- Clear extension data: `chrome://extensions/` → Extension details → "Clear site data"

---

## 6. Verify Files

### Reference Files (created)
```
reference_files/
├── convert_to_onnx.py
├── onnx_browser_example.js
├── onnx_test.html
├── README_convert_to_onnx.md
├── ONNX_INTEGRATION_SUMMARY.md
└── QUICKSTART.md (this file)
```

### Extension Files (modified)
```
src/
├── constants.js (added selectedModel)
├── background.js (added selectedModel)
├── popup.html (added model selector)
├── popup.js (load/save selectedModel)
├── offscreen.js (runtime switching)
├── offscreen.html (ONNX Runtime CDN)
└── modules/
    ├── settings.js (getSelectedModel, changeModel event)
    └── onnx_detector.js (NEW - ONNX wrapper)
```

### Model Output (to be generated)
```
src/assets/models/efficientnetb0/
├── efficientnet_b0_20250924_055016_best.pth (existing)
└── efficientnet_b0.onnx (generated by conversion script)
```

---

## Summary

1. **Convert**: `python reference_files\convert_to_onnx.py`
2. **Test**: Open `onnx_test.html` via local server
3. **Load**: Load extension in Chrome
4. **Switch**: Use Advanced Options → Detection Model dropdown
5. **Debug**: Check console logs in offscreen/background/content

For detailed documentation, see `reference_files/README_convert_to_onnx.md` and `ONNX_INTEGRATION_SUMMARY.md`.
